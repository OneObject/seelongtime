<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	version="2.5">
	<display-name>iapp student portal</display-name>
	
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>
			classpath*:/com.longtime.context.xml
		</param-value>
	</context-param>
	<!-- 
	<context-param>
		<param-name>spring.profiles.default</param-name>
		<param-value>production</param-value>
	</context-param>
 	-->
	<listener>
		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
	</listener>


	<filter>
		<filter-name>encodingFilter</filter-name>
		<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
		<init-param>
			<param-name>encoding</param-name>
			<param-value>UTF-8</param-value>
		</init-param>
		<init-param>
			<param-name>forceEncoding</param-name>
			<param-value>true</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>encodingFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	
	<filter>
		<filter-name>xssfilter</filter-name>
		<filter-class>com.longtime.ajy.filter.XssFilter</filter-class>
	</filter>
	<filter-mapping>
		<filter-name>xssfilter</filter-name>
		<url-pattern>*.xhtml</url-pattern>
	</filter-mapping>
	<filter-mapping>
		<filter-name>xssfilter</filter-name>
		<url-pattern>*.list</url-pattern>
	</filter-mapping>
	<filter-mapping>
		<filter-name>xssfilter</filter-name>
		<url-pattern>*.dlg</url-pattern>
	</filter-mapping>
	<filter-mapping>
		<filter-name>xssfilter</filter-name>
		<url-pattern>*.json</url-pattern>
	</filter-mapping>
	
	
	<servlet>
		<servlet-name>springServlet</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
		<init-param>
			<param-name>contextConfigLocation</param-name>
			<param-value>/WEB-INF/spring-mvc.xml</param-value>
		</init-param>
		<load-on-startup>1</load-on-startup>
	</servlet>
	<servlet-mapping>
		<servlet-name>springServlet</servlet-name>
		<url-pattern>/</url-pattern>
	</servlet-mapping>
	
	<servlet>
		<servlet-name>path-servlet</servlet-name>
		<servlet-class>com.longtime.common.PathServlet</servlet-class>
		<load-on-startup>10</load-on-startup>
	</servlet>
	
	
	<!--Kaptcha 验证码  -->
        <servlet>  
            <servlet-name>kaptcha</servlet-name>  
            <servlet-class>com.longtime.common.web.KaptchaExtServlet</servlet-class>  
            <init-param>  
                <param-name>kaptcha.border</param-name>  
                <param-value>no</param-value>  
            </init-param>  
            <init-param>  
                <param-name>kaptcha.textproducer.font.color</param-name>  
                <param-value>96,171,70</param-value>  
            </init-param> 
            <init-param>  
                <param-name>kaptcha.noise.color</param-name>  
                <param-value>47,144,194</param-value>  
            </init-param>  
            <init-param>   <!-- 不设置干扰 -->
                <param-name>kaptcha.noise.impl</param-name>  
                <param-value>com.google.code.kaptcha.impl.NoNoise </param-value>  
            </init-param>  
            <init-param>  
                <param-name>kaptcha.image.width</param-name>  
                <param-value>58</param-value>  
            </init-param>  
            <init-param>  
                <param-name>kaptcha.image.height</param-name>  
                <param-value>30</param-value>  
            </init-param>  
            <init-param>  
                <param-name>kaptcha.textproducer.font.size</param-name>  
                <param-value>28</param-value>  
            </init-param> 
            <init-param>  
                <param-name>kaptcha.textproducer.char.string</param-name>  
                <param-value>0123456789</param-value>  
            </init-param> 
            <init-param>  
                <param-name>kaptcha.textproducer.char.length</param-name>  
                <param-value>4</param-value>  
            </init-param>  
            <init-param>  
                <param-name>kaptcha.obscurificator.impl</param-name>  
                <param-value>com.google.code.kaptcha.impl.WaterRipple</param-value>  
            </init-param>   
            <init-param>  
                <param-name>kaptcha.background.clear.from</param-name>  
                <param-value>white</param-value>  
            </init-param>   
              
        </servlet>  
        <servlet-mapping>  
			<servlet-name>kaptcha</servlet-name>  
			<url-pattern>/api/captcha.do</url-pattern>
		</servlet-mapping>  
		

	<!-- 子域名 -->
	<filter>
		<filter-name>SubDomainFilter</filter-name>
		<filter-class>com.longtime.ajy.support.SubDomainHelper</filter-class>
		<init-param>
			<param-name>subdomain_excludes</param-name>
			<param-value>www,beta,cloud,demo,socketio,demosocketio,hrweixin,video,static,ennicoach</param-value>
		</init-param>
		<init-param>
			<param-name>excludes</param-name>
			<param-value>/resource/*,/static/*,/user/avatar/*</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>SubDomainFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	
	
	<!-- threadlocal value setter -->
	<filter>
		<filter-name>LocalSessionThreadLocalSetFilter</filter-name>
		<filter-class>com.longtime.ajy.session.LocalSessionThreadLocalSetFilter</filter-class>
		<init-param>
			<param-name>excludes</param-name>
			<param-value>/resource/*,/static/*,/m/error/*</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>LocalSessionThreadLocalSetFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	


	<!-- 刷新domain -->
	<filter>
		<filter-name>FlushDomainFilter</filter-name>
		<filter-class>com.longtime.ajy.mweb.filter.FlushDomainFilter</filter-class>
		<init-param>
			<param-name>excludes</param-name>
			<param-value>/m/ixin/nsurvey/*,/m/login.*,/m/h5/login.*,/m/logout.*,/resource/*,/m/wx_bind.*,/m/wx_oauth_redirect.*,/m/wx_bind_test.*,/m/register.*,/m/oauth_*</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>FlushDomainFilter</filter-name>
		<url-pattern>/m/*</url-pattern>
	</filter-mapping>
	
	
	<!-- weixin 获取openid -->
	<!-- <filter>
		<filter-name>MWeiXinOpenidFilter</filter-name>
		<filter-class>com.longtime.ajy.mweb.filter.MWeiXinOpenidFilter</filter-class>
		<init-param>
			<param-name>excludes</param-name>
			<param-value>/m/h5/custom/*,/m/error/*,/m/login.*,/m/logout.*,/resource/*,/m/wx_bind.*,/m/wx_oauth_redirect.*,/m/wx_bind_test.*,/m/register.*,/m/oauth_*</param-value>
		</init-param>
	</filter>
	
	<filter-mapping>
		<filter-name>MWeiXinOpenidFilter</filter-name>
		<url-pattern>/m/*</url-pattern>
	</filter-mapping> -->
	
	<!-- mobile web登录过滤 -->
	<filter>
		<filter-name>mwebLoginFilter</filter-name>
		<filter-class>com.longtime.ajy.mweb.filter.MwebLoginFilter3</filter-class>
		<init-param>
			<param-name>excludes</param-name>
			<param-value>/m/ixin/nsurvey/*,/m/ext/enn/tool/*,/m/ext/enn/findpwd/*,/m/ext/enn/uxue/autologin.xhtml,/m/ext/enn/active.*,/m/ext/enn/login.*,/m/h5/custom/*,/m/error/*,/m/h5/findpwd.*,/api/*,/m/login.*,/m/h5/login.*,/m/logout.*,/m/wx_bind.*,/resource/*,/m/wx_oauth_redirect.*,/m/wx_bind_test.*,/m/register.*,/user/avatar/*,/m/ixin/channelresource/list.xhtml,/m/ixin/fodder/detail.*,/m/h5/index_ajy.xhtml,/m/h5/channelresource/open.xhtml,/m/h5/channelresource/nlist.json,/m/oauth_*</param-value>
		</init-param>
	</filter>
	
	<filter-mapping>
		<filter-name>mwebLoginFilter</filter-name>
		<url-pattern>/m/*</url-pattern>
	</filter-mapping>
	
	
	<!-- 登录过滤 -->
	<filter>
		<filter-name>localLoginFilter</filter-name>
		<filter-class>com.longtime.ajy.student.filter.LocalLoginFilter</filter-class>
		<init-param>
			<param-name>excludes</param-name>
			<param-value>/survey/attend*,/survey/saveanswer*,/survey/prompt*,/survey/result*,/statistics/*,/api/*,/widget/*,/login.*,logout.*,/static/*,/resource/*,/m/*,/user/avatar/*,/ios/*,/notify/transfer.*</param-value>
		</init-param>
	</filter>
	
	<filter-mapping>
		<filter-name>localLoginFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	
	<filter>
		<filter-name>sitemeshFilter</filter-name>
		<filter-class>com.opensymphony.sitemesh.webapp.SiteMeshFilter</filter-class>
	</filter>
	<filter-mapping>
		<filter-name>sitemeshFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	
	<!-- 用户访问足迹 -->
	<filter>  
	    <filter-name>userTrackFilter</filter-name>  
	    <filter-class>com.longtime.ajy.filter.UserTrackFilter</filter-class>
	    <init-param>
	    	<param-name>isTrack</param-name>
	    	<param-value>true</param-value>
	    </init-param>   
	</filter>  
	  
	<filter-mapping>  
	    <filter-name>userTrackFilter</filter-name>  
	    <url-pattern>*.xhtml</url-pattern>    
	</filter-mapping>
	
	
	<!-- 设置语言环境 -->
	<filter>  
	    <filter-name>languageSettingFilter</filter-name>  
	    <filter-class>com.longtime.ajy.filter.LanguageSettingFilter</filter-class>
	</filter> 
	
	<filter-mapping>
		<filter-name>languageSettingFilter</filter-name>
		<url-pattern>*.xhtml</url-pattern>
	</filter-mapping>
	<filter-mapping>
		<filter-name>languageSettingFilter</filter-name>
		<url-pattern>*.list</url-pattern>
	</filter-mapping>
	<filter-mapping>
		<filter-name>languageSettingFilter</filter-name>
		<url-pattern>*.dlg</url-pattern>
	</filter-mapping>
	<filter-mapping>
		<filter-name>languageSettingFilter</filter-name>
		<url-pattern>*.json</url-pattern>
	</filter-mapping>
	
	
	<session-config>
		<session-timeout>60</session-timeout><!-- 单位 分钟 -->
	</session-config>
 
	<error-page>
		<exception-type>java.lang.Throwable</exception-type>
		<location>/WEB-INF/views/error/500.jsp</location>
	</error-page>
	<error-page>
		<error-code>500</error-code>
		<location>/WEB-INF/views/error/500.jsp</location>
	</error-page>
	<error-page>
		<error-code>404</error-code>
		<location>/WEB-INF/views/error/404.jsp</location>
	</error-page>
	
	

	<jsp-config>
		<taglib id="taglib-elfunctions">
			<taglib-uri>http://www.longtimeit.com/taglib-elfunctions</taglib-uri>
			<!-- tld文件的路径 -->
			<taglib-location>/WEB-INF/tld/functions.taglib.xml</taglib-location>
		</taglib>
		<taglib>
			<taglib-uri>http://www.longtimeit.com/taglib-elfunctions-ajy</taglib-uri>
			<!-- tld文件的路径 -->
			<taglib-location>/WEB-INF/tld/ajy/ajy.functions.taglib.xml</taglib-location>
		</taglib>
		<taglib id="taglib-study">
		    <taglib-uri>http://www.longtimeit.com/taglib-study</taglib-uri> 
			<taglib-location>/WEB-INF/tld/ajy/study.taglib.xml</taglib-location>
		</taglib>
		<taglib>
			<taglib-uri>http://www.longtimeit.com/taglib-sns</taglib-uri>
			<!-- tld文件的路径 -->
			<taglib-location>/WEB-INF/tld/ajy/sns.taglib.xml</taglib-location>
		</taglib>
	</jsp-config>
	
	<welcome-file-list>
       <welcome-file>index.html</welcome-file>
   </welcome-file-list>
   
</web-app>